#ifndef BITS_UTILITY_H
#define BITS_UTILITY_H

#include <cstdint>

#define R2(n)    n,     n + 2*64,     n + 1*64,     n + 3*64
#define R4(n) R2(n), R2(n + 2*16), R2(n + 1*16), R2(n + 3*16)
#define R6(n) R4(n), R4(n + 2*4 ), R4(n + 1*4 ), R4(n + 3*4 )

const uint32_t lookuptable[256] = { R6(0), R6(2), R6(1), R6(3) };

const uint32_t lookupmasks[32] = {
  0b00000000000000000000000000000001,
  0b00000000000000000000000000000011,
  0b00000000000000000000000000000111,
  0b00000000000000000000000000001111,
  0b00000000000000000000000000011111,
  0b00000000000000000000000000111111,
  0b00000000000000000000000001111111,
  0b00000000000000000000000011111111,
  0b00000000000000000000000111111111,
  0b00000000000000000000001111111111,
  0b00000000000000000000011111111111,
  0b00000000000000000000111111111111,
  0b00000000000000000001111111111111,
  0b00000000000000000011111111111111,
  0b00000000000000000111111111111111,
  0b00000000000000001111111111111111,
  0b00000000000000011111111111111111,
  0b00000000000000111111111111111111,
  0b00000000000001111111111111111111,
  0b00000000000011111111111111111111,
  0b00000000000111111111111111111111,
  0b00000000001111111111111111111111,
  0b00000000011111111111111111111111,
  0b00000000111111111111111111111111,
  0b00000001111111111111111111111111,
  0b00000011111111111111111111111111,
  0b00000111111111111111111111111111,
  0b00001111111111111111111111111111,
  0b00011111111111111111111111111111,
  0b00111111111111111111111111111111,
  0b01111111111111111111111111111111,
  0b11111111111111111111111111111111,
};

inline uint32_t bits_reverse(int len, uint32_t val)
{
  return (lookuptable[(val      ) & 0xff] << 24 |
          lookuptable[(val >>  8) & 0xff] << 16 |
          lookuptable[(val >> 16) & 0xff] <<  8 |
          lookuptable[(val >> 24) & 0xff]
         ) >> (sizeof(uint32_t)*8 - len);
}

inline int hamming_weight(unsigned int n) {
    return __builtin_popcount(n);
}

inline int hamming_weight(unsigned long long n) {
    return __builtin_popcountll(n);
}

inline int hamming_distance(unsigned int x, unsigned int y)
{
    return __builtin_popcount(x ^ y);
}

inline int hamming_distance(unsigned long long x, unsigned long long y)
{
    return __builtin_popcountll(x ^ y);
}

#endif //BITS_UTILITY_H
